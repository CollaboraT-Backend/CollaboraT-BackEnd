// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id              String           @id @default(uuid()) @db.Uuid
  name            String           @unique @db.VarChar(255)
  email           String           @unique @db.VarChar(255)
  password        String           @db.VarChar(255)
  nit             String           @unique @db.VarChar(255)
  role            String           @default("company") @db.VarChar(50)
  createdAt       DateTime         @default(now()) @db.Timestamp(6)
  updatedAt       DateTime         @updatedAt @db.Timestamp(6)
  deletedAt       DateTime?        @db.Timestamp(6)
  projects        Project[]
  collaborators   Collaborator[]
  profilePictures ProfilePicture[]

  @@map("companies")
}

model Collaborator {
  id               String             @id @default(uuid()) @db.Uuid
  name             String             @db.VarChar(255)
  email            String             @unique @db.VarChar(255)
  password         String             @db.VarChar(255)
  role             CollaboratorRole   @default(collaborator)
  companyId        String             @db.Uuid
  occupationId     Int
  createdAt        DateTime           @default(now()) @db.Timestamp(6)
  updatedAt        DateTime           @updatedAt @db.Timestamp(6)
  deletedAt        DateTime?          @db.Timestamp(6)
  company          Company            @relation(fields: [companyId], references: [id])
  occupation       Occupation         @relation(fields: [occupationId], references: [id])
  projects         Project[]
  projectTeams     ProjectTeam[]
  tasksAssigned    Task[]             @relation("CollaboratorAssigned")
  tasksCreated     Task[]             @relation("CollaboratorCreated")
  profilePictures  ProfilePicture[]
  TeamCollaborator TeamCollaborator[]
  TaskComment      TaskComment[]
  @@map("collaborators")
}

model Occupation {
  id            Int              @id @default(autoincrement())
  name          String           @db.VarChar(255)
  collaborators Collaborator[]
  tasks         TaskOccupation[]
  @@map("occupations")
}

model Project {
  id           String        @id @default(uuid()) @db.Uuid
  name         String        @db.VarChar(255)
  description  String?       @db.Text
  goals        String?       @db.Text
  deadline     DateTime      @db.Date
  companyId    String        @db.Uuid
  leaderId     String        @db.Uuid
  createdAt    DateTime      @default(now()) @db.Timestamp(6)
  updatedAt    DateTime      @updatedAt @db.Timestamp(6)
  deletedAt    DateTime?     @db.Timestamp(6)
  status       ProjectStatus @default(active)
  company      Company       @relation(fields: [companyId], references: [id])
  leader       Collaborator  @relation(fields: [leaderId], references: [id])
  projectTeams ProjectTeam[]
  tasks        Task[]
  @@map("projects")
}

model ProjectTeam {
  id                String             @id @default(uuid()) @db.Uuid
  projectId         String             @db.Uuid
  leaderId          String             @db.Uuid
  createdAt         DateTime           @default(now()) @db.Timestamp(6)
  updatedAt         DateTime           @updatedAt @db.Timestamp(6)
  project           Project            @relation(fields: [projectId], references: [id])
  leader            Collaborator       @relation(fields: [leaderId], references: [id])
  teamCollaborators TeamCollaborator[]
  @@map("project_teams")
}

model TeamCollaborator {
  id             String       @id @default(uuid()) @db.Uuid
  teamId         String       @db.Uuid
  collaboratorId String       @db.Uuid
  createdAt      DateTime     @default(now()) @db.Timestamp(6)
  deletedAt      DateTime?    @db.Timestamp(6)
  projectTeam    ProjectTeam  @relation(fields: [teamId], references: [id])
  collaborator   Collaborator @relation(fields: [collaboratorId], references: [id])
  @@map("team_collaborators")
}

model Task {
  id                     String           @id @default(uuid()) @db.Uuid
  name                   String           @db.VarChar(255)
  description            String?          @db.Text
  dueDate                DateTime         @db.Date
  startDate              DateTime         @db.Date
  priority               TaskPriority
  status                 TaskStatus       @default(pending)
  projectId              String           @db.Uuid
  collaboratorAssignedId String           @db.Uuid
  createdById            String           @db.Uuid
  createdAt              DateTime         @default(now()) @db.Timestamp(6)
  updatedAt              DateTime         @updatedAt @db.Timestamp(6)
  deletedAt              DateTime?        @db.Timestamp(6)
  project                Project          @relation(fields: [projectId], references: [id])
  collaboratorAssigned   Collaborator?    @relation("CollaboratorAssigned", fields: [collaboratorAssignedId], references: [id])
  createdBy              Collaborator     @relation("CollaboratorCreated", fields: [createdById], references: [id])
  occupations            TaskOccupation[]
  comments               TaskComment[]
  @@map("tasks")
}

model TaskOccupation {
  id           String     @id @default(uuid()) @db.Uuid
  taskId       String     @db.Uuid
  occupationId Int
  createdAt    DateTime   @default(now()) @db.Timestamp(6)
  deletedAt    DateTime?  @db.Timestamp(6)
  task         Task       @relation(fields: [taskId], references: [id])
  occupation   Occupation @relation(fields: [occupationId], references: [id])
  @@map("task_occupations")
}

model TaskComment {
  id        String       @id @default(uuid()) @db.Uuid
  comment   String       @db.Text
  taskId    String       @db.Uuid
  madeById  String       @db.Uuid
  createdAt DateTime     @default(now()) @db.Timestamp(6)
  task      Task         @relation(fields: [taskId], references: [id])
  madeBy    Collaborator @relation(fields: [madeById], references: [id])
  @@map("task_comments")
}

model ProfilePicture {
  id             String        @id @default(uuid()) @db.Uuid
  imageUrl       String        @db.Text
  collaboratorId String?       @db.Uuid
  companyId      String?       @db.Uuid
  collaborator   Collaborator? @relation(fields: [collaboratorId], references: [id])
  company        Company?      @relation(fields: [companyId], references: [id])
  @@map("profile_pictures")
}

model Entity {
  id          Int          @id @default(autoincrement())
  name        String       @db.VarChar(255)
  permissions Permission[]
  @@map("entites")
}

model Permission {
  id        String         @id @default(uuid()) @db.Uuid
  role      PermissionRole
  entityId  Int
  canGet    Boolean
  canGetOne Boolean
  canCreate Boolean
  canUpdate Boolean
  canDelete Boolean
  entity    Entity         @relation(fields: [entityId], references: [id])
  @@map("permissions")
}

enum CollaboratorRole {
  collaborator
  leader
}

enum ProjectStatus {
  active
  completed
  archived
}

enum TaskPriority {
  low
  medium
  high
}

enum TaskStatus {
  pending
  in_progress
  completed
}

enum PermissionRole {
  admin
  company
  leader
  collaborator
}
